<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>PCA Visualizer (p5.js)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
    <script defer src="pca.js"></script>
    <style>
      :root { --card: rgba(255,255,255,.92); --shadow: 0 10px 30px rgba(0,0,0,.12) }
      html,body{height:100%}
      body{
        margin:0; font-family:ui-sans-serif, system-ui, -apple-system, Arial;
        background: radial-gradient(1200px 800px at 20% -10%, #f4f7ff 0%, #eef2ff 35%, #eaf2ef 65%, #ffffff 100%);
      }
      canvas{ display:block; margin:0 auto; }
      #hud{
        position:fixed; left:50%; bottom:18px; transform:translateX(-50%);
        max-width:920px; width:calc(100% - 24px);
        background:var(--card); backdrop-filter: blur(10px);
        padding:12px 14px; border-radius:14px; border:1px solid rgba(0,0,0,.06);
        box-shadow:var(--shadow); font-size:14px; line-height:1.15; user-select:none;
        box-sizing:border-box; z-index:10;
      }
      .row{display:grid; grid-template-columns: auto 1fr auto auto 1fr auto; gap:10px 12px; align-items:center; margin:8px 0}
      .row label{min-width:72px; opacity:.8}
      .row input[type=range]{width:100%; max-width:280px}
      .pill{display:inline-block; padding:3px 8px; border-radius:999px; background:#f3f4f6; margin-left:6px}
      button{
        border-radius:10px; border:1px solid #ddd; padding:6px 10px; background:#fff; cursor:pointer;
        box-shadow:0 2px 8px rgba(0,0,0,.08)
      }
      .muted{opacity:.7}
      /* tiny bars for variance explained */
      .bar{flex:1 1 240px; height:8px; background:#eef2ff; border-radius:999px; position:relative; overflow:hidden}
      .bar > span{position:absolute; left:0; top:0; bottom:0; width:0%; background:#7aa2ff}
      .num{min-width:70px; text-align:right}
      @media (max-width: 640px){
        .row{ grid-template-columns: auto 1fr; }
        .row label{ min-width:64px }
        #hud{ bottom:12px; border-radius:12px; }
      }
    </style>
  </head>
  <body>
    <div id="hud">
      <div class="row">
        <strong>PCA Demo</strong>
        <span id="dims" class="pill"></span>
        <span class="muted" style="margin-left:auto">Shortcuts: <b>S</b> save · <b>R</b> regen · <b>G</b> proj</span>
      </div>

      <div class="row"><strong class="muted">Data</strong></div>
      <div class="row">
        <label>Points</label>
        <input id="nPts" type="range" min="20" max="2000" value="400" />
        <span id="nPtsVal" class="pill">400</span>

        <label>Anisotropy</label>
        <input id="anis" type="range" min="1" max="10" value="5" />
        <span id="anisVal" class="pill">5×</span>

        <label>Rotation</label>
        <input id="theta" type="range" min="0" max="180" value="30" />
        <span id="thetaVal" class="pill">30°</span>
      </div>

      <div class="row"><strong class="muted">Display</strong></div>
      <div class="row">
        <label>Show proj</label><input id="showProj" type="checkbox" checked />
        <label>Show axes</label><input id="showAxes" type="checkbox" checked />
        <label>Clusters</label><input id="kClusters" type="range" min="0" max="8" value="0" />
        <span id="kVal" class="pill">off</span>
        <label>Point size</label><input id="ptSize" type="range" min="1" max="8" value="3" />
        <span id="ptVal" class="pill">3px</span>
        <label>Color</label>
        <select id="colorMode">
          <option value="none">None</option>
          <option value="pc1">By PC₁</option>
          <option value="cluster">By Cluster</option>
        </select>
      </div>

      <div class="row"><strong class="muted">Animation</strong></div>
      <div class="row">
        <label>Spin</label><input id="spin" type="checkbox" />
        <label>Speed</label><input id="spinSpeed" type="range" min="0" max="120" value="30" />
        <span id="speedVal" class="pill">30°/s</span>
      </div>

      <div class="row"><strong class="muted">Variance</strong></div>
      <div class="row">
        <label>Mode</label>
        <select id="varMode">
          <option value="pca" selected>PCA (λ)</option>
          <option value="view">View (angle)</option>
        </select>
      </div>
      <div class="row">
        <label>PC₁</label><div class="bar"><span id="eig1"></span></div><span id="eig1val" class="num">0.000</span>
        <label>PC₂</label><div class="bar"><span id="eig2"></span></div><span id="eig2val" class="num">0.000</span>
      </div>

      <div class="row">
        <label>Reconstruct</label><input id="recon" type="checkbox" />
        <div></div><div></div>
        <div style="grid-column: 4 / -1; display:flex; gap:10px; justify-content:flex-end;">
          <button id="regen">Regenerate</button>
          <button id="export">Export CSV</button>
          <button id="save">Save PNG</button>
        </div>
      </div>
    </div>

    <!-- Helpers the sketch calls -->
    <script>
      window.updateDims = (w,h) => { const el = document.getElementById('dims'); if(el) el.textContent = `${w}×${h}`; };
      window.updateExplained = (pc1, pc2) => {
        const e1 = document.getElementById('eig1'), e2 = document.getElementById('eig2');
        const v1 = document.getElementById('eig1val'), v2 = document.getElementById('eig2val');
        const p1 = Math.max(0, Math.min(100, pc1*100)); const p2 = Math.max(0, Math.min(100, pc2*100));
        if(e1) e1.style.width = p1 + '%'; if(e2) e2.style.width = p2 + '%';
        if(v1) v1.textContent = pc1.toFixed(3); if(v2) v2.textContent = pc2.toFixed(3);
      };
    </script>
  </body>
</html>
